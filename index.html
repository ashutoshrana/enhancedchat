<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Salesforce Chat Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --capella-red: #C10016;
      --capella-red-dark: #910012;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      padding: 40px;
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      color: var(--capella-red);
    }

    /* Your branded circular launcher */
    #capellaChatBtn {
      background-image: url("https://www.capella.edu/content/dam/capella/chat/chat_btn_hover.png");
      background-color: transparent;
      background-size: cover;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      position: fixed;
      right: 50px;
      bottom: 35px;
      z-index: 3141591;
      border: none;
      cursor: pointer;
      text-indent: -9999px;
      overflow: hidden;
      transition: transform 0.2s ease;
    }
    #capellaChatBtn:hover {
      transform: scale(1.05);
    }
    #capellaChatBtn:focus {
      outline: 2px solid var(--capella-red);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <h1>Welcome to Salesforce Messaging Test</h1>
  <p>Click the chat button in the bottom right corner to start a conversation.</p>
  <p><strong>Prechat information is automatically configured:</strong></p>
  <ul>
    <li>Email: dogz@mailinator.com</li>
    <li>First Name: Test</li>
    <li>Last Name: User</li>
    <li>Subject: Chat Inquiry from Website</li>
  </ul>

  <!-- Your branded launcher -->
  <button id="capellaChatBtn" aria-label="Chat with us">Chat</button>

  <script>
    // Initialize Embedded Messaging
    function initEmbeddedMessaging() {
      try {
        console.log('ðŸš€ Initializing Salesforce Embedded Messaging...');
        embeddedservice_bootstrap.settings.language = 'en_US';

        embeddedservice_bootstrap.init(
          '00DEc00000GfZ2M',
          'admission_github',
          'https://strategiced--qasf.sandbox.my.site.com/ESWadmissiongithub1762055730119',
          {
            scrt2URL: 'https://strategiced--qasf.sandbox.my.salesforce-scrt.com'
          }
        );

      } catch (err) {
        console.error('Error loading Embedded Messaging:', err);
      }
    }

    // Chat button created - set up custom launcher and prechat fields
    window.addEventListener('onEmbeddedMessagingButtonCreated', () => {
      console.log('âœ… Chat button created - ready to launch');

      // Configure hardcoded prechat fields (NOW that prechatAPI is available)
      try {
        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
          Email: 'dogz@mailinator.com',
          FirstName: 'Test',
          LastName: 'User',
          Subject: 'Chat Inquiry from Website'
        });
        console.log('âœ… Prechat fields configured: dogz@mailinator.com');
      } catch (err) {
        console.error('Error setting prechat fields:', err);
      }

      // Hide default Salesforce button
      if (embeddedservice_bootstrap.utilAPI?.hideChatButton) {
        embeddedservice_bootstrap.utilAPI.hideChatButton();
      }

      // Set up custom button click handler
      const customBtn = document.getElementById('capellaChatBtn');
      if (customBtn) {
        customBtn.addEventListener('click', () => {
          console.log('ðŸ–±ï¸ Chat button clicked - launching chat');
          embeddedservice_bootstrap.utilAPI
            .launchChat()
            .then(() => {
              console.log('âœ… Chat launched successfully');
            })
            .catch((e) => {
              console.error('âŒ Launch Chat failed:', e);
            });
        });
      }
    });

    // Conversation events
    window.addEventListener('onEmbeddedMessagingConversationStarted', () => {
      console.log('ðŸ’¬ Conversation started - agent connected');
      document.getElementById('capellaChatBtn').style.display = 'none';
    });

    window.addEventListener('onEmbeddedMessagingWindowMaximized', () => {
      document.getElementById('capellaChatBtn').style.display = 'none';
    });

    window.addEventListener('onEmbeddedMessagingWindowMinimized', () => {
      document.getElementById('capellaChatBtn').style.display = 'block';
    });

    window.addEventListener('onEmbeddedMessagingConversationClosed', () => {
      document.getElementById('capellaChatBtn').style.display = 'block';
    });
  </script>

  <!-- Salesforce bootstrap -->
  <script
    src="https://strategiced--qasf.sandbox.my.site.com/ESWadmissiongithub1762055730119/assets/js/bootstrap.min.js"
    onload="initEmbeddedMessaging()"
  ></script>
</body>
</html>
