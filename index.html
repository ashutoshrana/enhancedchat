<!DOCTYPE html>
<html>
<head>
  <title>Salesforce Chat Demo</title>
</head>
<body>
  <h1>Welcome to Salesforce Messaging Test</h1>
  <p>If the widget is set up correctly, you should see the chat bubble in the corner.</p>

  <!-- Salesforce Messaging Snippet -->
<!-- Optional: your branded circular launcher (mirrors legacy look) -->
<style>
  #capellaChatBtn {
    background-image: url("https://www.capella.edu/content/dam/capella/chat/chat_btn_hover.png");
    background-color: transparent;
    width: 54px; height: 54px; border-radius: 50%;
    position: fixed; right: 50px; bottom: 35px; z-index: 3141591;
    border: none; cursor: pointer; text-indent: -9999px; overflow: hidden;
  }
  #capellaChatBtn:focus { outline: 1px solid #C10016; }
</style>

<button id="capellaChatBtn" aria-label="Chat with us">Chat</button>

<!-- Your MIAW (Enhanced Chat) deployment -->
<script type="text/javascript">
  // 1) Init with your sandbox deployment
  function initEmbeddedMessaging() {
    try {
      embeddedservice_bootstrap.settings.language = 'en_US'; // e.g., 'en' or 'en-US'

      embeddedservice_bootstrap.init(
        '00DEc00000GfZ2M',                                                     // ORG ID
        'test_embed',                                                          // Deployment name
        'https://strategiced--qasf.sandbox.my.site.com/ESWtestembed1760850249724', // Enhanced Service URL
        { scrt2URL: 'https://strategiced--qasf.sandbox.my.salesforce-scrt.com' }   // SCRT2
      );
    } catch (err) {
      console.error('Error loading Embedded Messaging: ', err);
    }
  }

  // 2) Pre-Chat API: set hidden/visible fields once the client is ready
  //    IMPORTANT: Use your *channel variable names* here (Messaging Settings â†’ Parameter Mappings)
  window.addEventListener('onEmbeddedMessagingReady', () => {
    // Hidden fields (e.g., legacy "Chat Source")
    embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
      // Replace "Chat_Source" with your Custom Parameter's **Channel Variable Name**
      "Chat_Source": "ES_General"
    });

    // (Optional) Prefill visible fields
    // embeddedservice_bootstrap.prechatAPI.setVisiblePrechatFields({
    //   "_firstName": { value: "Visitor", isEditableByEndUser: true },
    //   "_subject":   { value: "Web Chat", isEditableByEndUser: true }
    // });
  });

  // 3) Use your own branded launcher and hide Salesforce's default one (optional)
  window.addEventListener('onEmbeddedMessagingButtonCreated', () => {
    // Hide default floating launcher if you prefer only your custom button
    if (embeddedservice_bootstrap.utilAPI && embeddedservice_bootstrap.utilAPI.hideChatButton) {
      embeddedservice_bootstrap.utilAPI.hideChatButton();
    }

    const customBtn = document.getElementById('capellaChatBtn');
    if (customBtn) {
      customBtn.addEventListener('click', () => {
        // Launch the chat with the window maximized
        embeddedservice_bootstrap.utilAPI
          .launchChat()
          .catch((e) => console.error('Launch Chat failed:', e));
      });
    }
  });

  // 4) Hide chat button once conversation starts
  window.addEventListener('onEmbeddedMessagingConversationStarted', () => {
    console.log('Conversation started - hiding chat button');
    const customBtn = document.getElementById('capellaChatBtn');
    if (customBtn) {
      customBtn.style.display = 'none';
    }
  });

  // 5) Show chat button again when conversation ends (optional)
  window.addEventListener('onEmbeddedMessagingConversationEnded', () => {
    console.log('Conversation ended - showing chat button again');
    const customBtn = document.getElementById('capellaChatBtn');
    if (customBtn) {
      customBtn.style.display = 'block';
    }
  });

  // 6) Hide chat button when chat window is maximized
  window.addEventListener('onEmbeddedMessagingMaximized', () => {
    console.log('Chat maximized - hiding chat button');
    const customBtn = document.getElementById('capellaChatBtn');
    if (customBtn) {
      customBtn.style.display = 'none';
    }
  });

  // 7) Show chat button when chat window is minimized
  window.addEventListener('onEmbeddedMessagingMinimized', () => {
    console.log('Chat minimized - showing chat button again');
    const customBtn = document.getElementById('capellaChatBtn');
    if (customBtn) {
      customBtn.style.display = 'block';
    }
  });
</script>

<!-- Bootstrap (loader) for your deployment; keeps your onload init -->
<script type="text/javascript"
        src="https://strategiced--qasf.sandbox.my.site.com/ESWtestembed1760850249724/assets/js/bootstrap.min.js"
        onload="initEmbeddedMessaging()"></script>

</body>
</html>