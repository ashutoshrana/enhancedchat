<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Chat Button Diagnostic</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }
    .log-entry {
      padding: 8px;
      margin: 4px 0;
      border-left: 3px solid #ccc;
      background: #f5f5f5;
    }
    .log-entry.success { border-color: #10B981; background: #ecfdf5; }
    .log-entry.warning { border-color: #F59E0B; background: #fffbeb; }
    .log-entry.error { border-color: #EF4444; background: #fef2f2; }
    .status-box {
      padding: 16px;
      margin: 16px 0;
      border: 2px solid #ddd;
      border-radius: 8px;
    }
    h1 { color: #C10016; }
    h2 { color: #333; margin-top: 24px; }
    pre { background: #f5f5f5; padding: 12px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üîç Chat Button Diagnostic Tool</h1>
  <p><strong>Purpose:</strong> Diagnose why the Salesforce chat button is not appearing</p>

  <div id="diagnosticLogs"></div>

  <h2>üìä Current State</h2>
  <div id="currentState" class="status-box"></div>

  <h2>üéØ Expected Behavior</h2>
  <div class="status-box">
    <ol>
      <li>Page loads ‚Üí Salesforce script initializes</li>
      <li><code>onEmbeddedMessagingReady</code> fires</li>
      <li><code>onEmbeddedMessagingButtonCreated</code> fires</li>
      <li><code>updateChatAvailability('button_created')</code> called</li>
      <li><code>showChatButton()</code> called</li>
      <li><code>embeddedservice_bootstrap.utilAPI.showChatButton()</code> executed</li>
      <li>‚úÖ Chat button appears</li>
    </ol>
  </div>

  <h2>üìù Console Instructions</h2>
  <div class="status-box">
    <p>Open browser console (F12) and run these commands:</p>
    <pre>// Check Salesforce objects
console.log('embeddedservice_bootstrap:', typeof embeddedservice_bootstrap);
console.log('utilAPI:', embeddedservice_bootstrap?.utilAPI);

// Check state variables
console.log('isWithinBusinessHours:', isWithinBusinessHours);
console.log('noAgentsAvailable:', noAgentsAvailable);
console.log('businessHoursEventFired:', businessHoursEventFired);

// Try to manually show button
embeddedservice_bootstrap?.utilAPI?.showChatButton();</pre>
  </div>

  <script>
    const logs = [];

    function addLog(message, type = 'info') {
      const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
      logs.push({ timestamp, message, type });
      renderLogs();
    }

    function renderLogs() {
      const container = document.getElementById('diagnosticLogs');
      container.innerHTML = '<h2>üìã Event Log</h2>' + logs.map(log =>
        `<div class="log-entry ${log.type}">[${log.timestamp}] ${log.message}</div>`
      ).join('');
    }

    function updateState() {
      const stateDiv = document.getElementById('currentState');
      stateDiv.innerHTML = `
        <strong>Salesforce Objects:</strong><br>
        ‚Ä¢ embeddedservice_bootstrap: ${typeof embeddedservice_bootstrap !== 'undefined' ? '‚úÖ Loaded' : '‚ùå Not loaded'}<br>
        ‚Ä¢ utilAPI: ${typeof embeddedservice_bootstrap !== 'undefined' && embeddedservice_bootstrap.utilAPI ? '‚úÖ Available' : '‚ùå Not available'}<br>
        <br>
        <strong>State Variables:</strong><br>
        ‚Ä¢ isWithinBusinessHours: ${typeof isWithinBusinessHours !== 'undefined' ? isWithinBusinessHours : 'undefined'}<br>
        ‚Ä¢ noAgentsAvailable: ${typeof noAgentsAvailable !== 'undefined' ? noAgentsAvailable : 'undefined'}<br>
        ‚Ä¢ businessHoursEventFired: ${typeof businessHoursEventFired !== 'undefined' ? businessHoursEventFired : 'undefined'}<br>
      `;
    }

    // Initial state
    addLog('Diagnostic page loaded', 'success');
    updateState();
    setInterval(updateState, 1000);

    // Monitor Salesforce events
    window.addEventListener('onEmbeddedMessagingReady', () => {
      addLog('‚úÖ onEmbeddedMessagingReady fired', 'success');
      updateState();
    });

    window.addEventListener('onEmbeddedMessagingButtonCreated', () => {
      addLog('‚úÖ onEmbeddedMessagingButtonCreated fired', 'success');
      updateState();

      // Check if utilAPI is available NOW
      setTimeout(() => {
        if (typeof embeddedservice_bootstrap !== 'undefined' && embeddedservice_bootstrap.utilAPI) {
          addLog('‚úÖ utilAPI is available after ButtonCreated', 'success');

          // Try to show the button manually
          try {
            embeddedservice_bootstrap.utilAPI.showChatButton();
            addLog('‚úÖ Called utilAPI.showChatButton() manually', 'success');
          } catch (e) {
            addLog('‚ùå Error calling showChatButton(): ' + e.message, 'error');
          }
        } else {
          addLog('‚ö†Ô∏è utilAPI still not available after ButtonCreated', 'warning');
        }
      }, 100);
    });

    window.addEventListener('onEmbeddedMessagingWithinBusinessHours', (event) => {
      addLog(`‚è∞ Business Hours event: ${event.detail.withinBusinessHours}`, 'success');
    });

    // Log any errors
    window.addEventListener('error', (event) => {
      addLog(`‚ùå Error: ${event.message}`, 'error');
    });

    // Check script loading
    const script = document.querySelector('script[src*="bootstrap.min.js"]');
    if (script) {
      addLog('‚úÖ Salesforce bootstrap script tag found', 'success');

      script.addEventListener('load', () => {
        addLog('‚úÖ Salesforce bootstrap script loaded', 'success');
        updateState();
      });

      script.addEventListener('error', () => {
        addLog('‚ùå Salesforce bootstrap script failed to load', 'error');
      });
    } else {
      addLog('‚ùå Salesforce bootstrap script tag NOT found', 'error');
    }
  </script>

  <!-- Same Salesforce bootstrap as main page -->
  <script
    src="https://strategiced--qasf.sandbox.my.site.com/ESWadmissiongithub1762055730119/assets/js/bootstrap.min.js"
    onload="addLog('‚úÖ Bootstrap onload fired', 'success'); typeof initEmbeddedMessaging === 'function' && initEmbeddedMessaging();"
  ></script>
</body>
</html>
